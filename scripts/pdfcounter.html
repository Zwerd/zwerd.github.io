<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>חילוץ טקסט מ-PDF - ספירת אותיות</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Varela Round', 'Inter', sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    direction: rtl;
    min-height: 100vh;
  }

  h1 {
    margin: 40px 20px 20px 20px;
    color: #1a1a1a;
    text-align: center;
  }

  .card {
    background: #ffffff;
    width: 95%;
    max-width: 800px;
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #fileInput {
    display: none;
  }

  .button {
    padding: 14px 30px;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    min-width: 200px;
    text-align: center;
    border: none;
    transition: all 0.3s ease;
    margin: 10px 0;
    font-size: 16px;
  }

  .file-label {
    background: #4f46e5;
    color: #fff;
  }

  .file-label:hover {
    background: #4338ca;
  }

  #calculateButton {
    background: #10b981;
    color: #fff;
  }

  #calculateButton:hover {
    background: #059669;
  }

  .progress {
    width: 100%;
    background: #e0e0e0;
    height: 12px;
    border-radius: 6px;
    overflow: hidden;
    margin-top: 10px;
    display: none;
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: #4f46e5;
    transition: width 0.3s ease;
  }

  #output {
    white-space: pre-wrap;
    font-size: 17px;
    line-height: 1.7;
    color: #111827;
    max-height: 400px;
    overflow-y: auto;
    padding: 20px;
    background: #f9fafb;
    border-radius: 12px;
    margin-top: 15px;
    width: 100%;
    text-align: right;
  }

  #summary {
    font-size: 16px;
    font-weight: 600;
    color: #1f2937;
    margin-top: 10px;
    text-align: center;
  }

  .note {
    font-size: 13px;
    color: #6b7280;
    margin-top: 5px;
    text-align: center;
  }

  @media (max-width: 600px) {
    .button {
      min-width: 140px;
      padding: 12px 20px;
    }

    #output {
      font-size: 16px;
      padding: 15px;
    }
  }

</style>
</head>
<body>

<h1>חילוץ טקסט מ-PDF וספירת אותיות</h1>

<div class="card">
  <label class="button file-label" for="fileInput">בחר קובץ PDF</label>
  <input type="file" id="fileInput" accept=".pdf">

  <button id="calculateButton" class="button">ספור אותיות</button>
  <div class="note">*לא נכללים: . , - _ '</div>

  <div class="progress" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div id="output"></div>
  <div id="summary"></div>
</div>

<script>
const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

let extractedText = '';

document.getElementById('fileInput').addEventListener('change', async function(event) {
  const file = event.target.files[0];
  extractedText = '';
  document.getElementById('output').textContent = '';
  document.getElementById('summary').textContent = '';

  if (file) {
    const reader = new FileReader();
    reader.onload = function() {
      const typedArray = new Uint8Array(this.result);
      extractTextFromPDF(typedArray);
    };
    reader.readAsArrayBuffer(file);
  }
});

document.getElementById('calculateButton').addEventListener('click', function() {
  const lettersFound = countLetters(extractedText);
  document.getElementById('summary').textContent = `סה"כ אותיות (למעט . , - _ '): ${lettersFound}`;
});

async function extractTextFromPDF(data) {
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progressBar');
  progressContainer.style.display = 'block';
  progressBar.style.width = '0%';

  try {
    const pdf = await pdfjsLib.getDocument(data).promise;
    const totalPages = pdf.numPages;

    for (let i = 1; i <= totalPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const textItems = content.items.map(item => item.str);
      extractedText += textItems.join(' ') + '\n\n';
      
      const progressPercent = Math.round((i / totalPages) * 100);
      progressBar.style.width = progressPercent + '%';
    }

    document.getElementById('output').textContent = extractedText;
    progressContainer.style.display = 'none';
  } catch (error) {
    console.error('Error occurred while extracting text:', error);
    progressContainer.style.display = 'none';
  }
}

function countLetters(text) {
  // כולל עברית ואנגלית, מחריג . , - _ '
  const regex = /[A-Za-z\u0590-\u05FF]/g;
  const matches = text.match(regex);
  return matches ? matches.length : 0;
}
</script>

</body>
</html>
