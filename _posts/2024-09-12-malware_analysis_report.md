---
layout: post
title: Malware Traffic Analysis Report.
categories: [Tutorials, Reports]
tag: [Malware Analysis , Network Traffic Analysis] 
---

# General 

**Report Overview:** This report has been prepared as part of an exercise featured on the Malware - Traffic-Analysis website. The exercise focuses on a specific incident, with downloadable files provided to support the investigation and analysis.

**Purpose:** The goal of this document is to present a thorough analysis of the suspicious and malicious activity captured in the provided .pcap file. The file contains network traffic recorded during a simulated event, which is available through the provided link.

**Content Structure:** The report offers a detailed examination of the event, closely following the format of a standard incident response document used in real-world production networks. It includes a comprehensive breakdown of the malicious activity observed, focusing on key indicators of compromise (IOCs) and other relevant data.

For full context and to view the exercise's description and accompanying files, please refer to the link provided. 

# Executive Summary

This report analyzes a network traffic capture (PCAP file) from **Asco Limited**, focusing on identifying suspicious and malicious activities within the organization's network. 

The investigation uncovered several indicators of compromise (IOCs), including abnormal network behavior and potential malware communication. 

These findings suggest a targeted attack on the network, with evidence of malicious actors attempting to establish unauthorized access. 

This summary outlines the key details of the incident, assesses the potential impact on **Asco Limited’s** infrastructure, and provides recommendations to mitigate future risks recommendations. 

# Incident Overview 

## Background 

The network traffic analyzed in this report was captured on February 8, 2021, from the organization ASCOLIMITED. The traffic originates from a local area network (LAN) segment with the IP range of 10.2.8.0/24, which spans from 10.2.8.0 to 10.2.8.255. The domain for the network is **ascolimited.com**, and the domain controller is identified as **AscoLimited-DC** with the IP address **10.2.8.2**. The gateway for this segment is **10.2.8.1**, and the broadcast address is **10.2.8.255**. This network layout provides the framework for analyzing suspicious and malicious activities within the traffic capture. 

### Summary: 

**LAN segment range**:  10.2.8.0/24 (10.2.8.0 through 10.2.8.255) **Domain**:  ascolimited.com 

**Domain controller**:  10.2.8.2 - AscoLimited-DC 

**LAN segment gateway**:  10.2.8.1 

**LAN segment broadcast address**:  10.2.8.255 

## Scope of the events 

The following table contains summary of what was found from the malicious traffic analysis, more details and technical information can be found on the POC section of this report. Please note, that information base only on the PCAP file, and the PN is Packet Number as start point of the malicious activity 



|PN |Time |Event |Descrition |
| - | - | - | - |
|2315 |15:59:12.458095000 UTC |Connection to tonmatdoanminh.com |The connection seems run by Windows Edge browser, the HTTP query is GET to uninviting.php file, the domain itself known as malicious on several vendors, the PHP code make new query that contain cookie of client UTC value. |
|2993 |15:59:18.369919000 UTC |JavaScript Manipolation on Client side |JavaScript from tonmatdoanminh.com was run on the client download hidden file with base64 and save it as **0208\_54741869750132.doc** it while redirect the client to another malicious domain (key.xn--nvigators-key-if2g.com) to download infected doc file named logon0208\_54741869750132.doc. That malware categorized as **Hancitor**. |
|2999 |15:59:18.557556000 UTC |Download Infected DOC File and Execute it |Client run DNS query and run TCP session with key.xn--nvigators-key-if2g.com for download doc file named logon0208\_54741869750132.doc overt TLS session. It also seems that the client executes that file. We can't get that doc file from the PCAP since the session are encrypted. |
|3812 |16:00:06.834697000 UTC |HTTP Session to api.ipify.org  |Session was made by the client to API service named api.ipify.org to get the external address of that host. |
|3825 |16:00:10.595678000 UTC |Client Push Personal Data |We can only assume that DOC's files was executed, then the client push sensitive data like username, computer name, domain name, windows version and external IP address to satursed.com,also that push done every 2 minutes. |
|3877 |16:00:12.297229000 UTC |Client Download Binaries Files |Also, a session to another domain (roanokemortgages.com) was made, then binaries (malwares) files was download to the client side. The files are: 0801.bin, 0801s.bin, **61hjgfdghj.exe**. The exe file categorized as **Filker Stealer**. |
|3886 |16:00:12.694358000 UTC |Client Made TCP session to 198.211.10.238:8080 |TCP session was made, it looks like related to the last DOC execution. From that session another  binary file was download named **6Aov**, after the download was complete the session was upgrade to TLS encryption session. This malware categorized a **Cobalt Strike**. |
|4729 |16:00:17.463901000 UTC |Client Made another TCP session to 185.100.65.29:80 |That session used to transfer 7MB of data, after that session end, we can see the previous one and the session to stursed.com send the same data every 2 minutes. |

## Indicators of Compromise (IOCs). 

The following contain the information about the indicators that can be used to implementation on systems and security components for prevent such malicious activities. 



|File Name |File Hash |
| - | - |
|6lhjgfdghj.exe |94e60de577c84625da69f785ffe7e24c889bfa6923dc7b017c21e8a313e4e8e1 |
|0801\.bin |ee33a8fa2ae6f6b9366c97ed4c00c2796d98a371249dca725a01aca03caf747b |
|0801s.bin |7af0dc117d2dcd112f50889c4c8a14ac9ee55c2525a24fa66ff9a89b480b7e99 |
|6Aov |e519c1e99f21fbc6754e2ed9ef38a12684d506617229b4ca87fcff86f6838250 |
|0208\_54741869750132.doc  |3a5648f7de99c4f87331c36983fc8adcd667743569a19c8dafdd5e8a33de154d |
|uninviting.php |858aac988e85075348f32e4750f17bf5c16e579fff258d3def9f23563e89372d |
|forum.php |3643b1eae555f0c273f0b7dcf095b6b292e9c2c5f22e7e80f29356e7cf336018 |
|Wh102yYa.tmp (W0rd.dll) |0d7aa23a72d22dcf47f8723c58d101b3b113cbc79dd407a6fac0e65d67076ea1 |



|IP |Domain/URL |
| - | - |
|162\.241.149.195  |key.xn—nvigators-key-if2g.com site |
|54\.235.147.252  |api.ipify.org |
|213\.5.229.12  |satursed.com |
|198\.211.10.238  |http://198[.]211[.]10[.]238:8080/ca |
|8\.208.10.147  |roanokemortgages.com |
|185\.100.65.29  |sweyblidian.com |
|45\.124.85.55 |tonmatdoanminh.com |

### Analysis and Explanation of the Attack Process 

During the analysis, we were able to understand what was append and what was done based on the timeline. In short, the attacker initiated the compromise through a phishing campaign (or other social engineering), leading the victim to a malicious domain and executing a weaponized document containing **Hancitor** malware. This malware initiated the download of multiple payloads, including **FickerStealer** and **Cobalt** **Strike**. The attack resulted in the exfiltration of sensitive information, control over the infected system, and continued data transfers to the attacker's servers.

The following describes the actions taken by the attacker to provide a clear view of the attack process.

**Event 1: Connection to tonmatdoanminh.com (PN 2315, 15:59:12 UTC)** The attack begins with a connection to the domain tonmatdoanminh.com. This connection is initiated by the client using Windows Edge, sending an HTTP GET request to a suspicious PHP file (uninviting.php). The PHP code appears to collect the client’s cookie and UTC value, potentially gathering information for the attacker to exploit in the next stage.

**Event 2: JavaScript Manipulation on Client Side (PN 2993, 15:59:18 UTC)** Shortly after, JavaScript from the malicious domain tonmatdoanminh.com executes on the client machine. This script downloads a hidden file in Base64 format and saves it as 0208\_54741869750132.doc. Simultaneously, the client is redirected to another malicious domain (key.xn--nvigators-key-if2g.com) where an infected document (logon0208\_54741869750132.doc) is downloaded. This document contains the Hancitor malware.

**Event 3: Download Infected DOC File and Execute it (PN 2999, 15:59:18 UTC)** The client now initiates a DNS query to resolve the domain key.xn--nvigators-key-if2g.com and establishes a TCP session over TLS to 

download the infected document. Although the session is encrypted, it’s clear that the client executes the malicious DOC file. 

**Event 4: HTTP Session to api.ipify.org (PN 3812, 16:00:06 UTC)** After the DOC file is executed, the client makes a request to the external API service api.ipify.org to retrieve its public IP address. This is likely used by the malware to determine the client’s external network details.

**Event 5: Client Pushes Personal Data (PN 3825, 16:00:10 UTC)** Following the DOC execution, the client transmits sensitive information such as the username, computer name, domain name, Windows version, and external IP address to a third malicious domain (satursed.com). This data exfiltration occurs at regular two - minute intervals, indicating continuous communication between the client and the attacker's infrastructure.

**Event 6: Client Downloads Binary Files (PN 3877, 16:00:12 UTC)** Next, the client initiates a session to yet another malicious domain (roanokemortgages.com). Multiple binary files, including 0801.bin, 0801s.bin, and an executable file 61hjgfdghj.exe, are downloaded. The executable is identified as FickerStealer malware, designed to steal sensitive information from the infected system.

**Event 7: Client Initiates TCP Session to 198.211.10.238:8080 (PN 3886, 16:00:12 UTC)** The client then establishes a TCP session to the IP address 198.211.10.238 on port 8080. During this session, another binary file (6Aov) is downloaded. After the download, the session transitions to a TLS-encrypted session. This file is identified as part of the Cobalt Strike toolkit, used for post-exploitation, command-and-control, and lateral movement within the network. 

**Event 8: Large Data Transfer to 185.100.65.29:80 (PN 4729, 16:00:17 UTC)** Finally, the client initiates another TCP session to the IP address 185.100.65.29, during which 7MB of data is transferred. After this session ends, 

the periodic communication with satursed.com continues every two minutes, indicating the ongoing exfiltration of stolen data. 

# Proof of Concept (POC) 

This section demonstrates the steps taken to identify and confirm the malicious activity observed in the captured network traffic. By leveraging analysis tools and methods, the following process outlines how the suspicious behavior was reproduced and validated. The POC serves to provide technical proof of the attack, showcasing the techniques used to detect the Indicators of Compromise (IOCs) and the malicious communication within the .pcap file.

The compressed files that provided by **Asco Limited** contain the following files: 

- 2021-02-08-traffic.pcap – contain the record traffic from the date 08/02/2021. 
- Alerts.jpg – contain screenshot from Sguil dashboard which is network security monitoring (NSM) interface and work with IDS engines like **Snort** or **Suricata**. The image itself showed alert from the IDS about malicious activities.  
- Alerts.txt – contain the same events information from Alerts.jpg in text format. 

Based on the provided files, a detailed analysis was done to examine the .pcap file and find all the important information. The steps below explain how the investigation was carried out to uncover the suspicious activity in the network. All the findings in this report include screenshots and, where possible, related text or event logs to support the analysis 

## Step 1: Information Gathering 

From the screenshot of the Squil dashboard (alerts.jpg), we can see information (from the IDS device, like snort or suricata) about alerted malicious activities on the date 08/02/2021. That file contain the based information we can use on that assessment, first of all the local network IP address that look like the victim and the related addresses that we will try to find more information about them later, also we can see the Event Massages that contain details about the activities itself. Also that information can be found on the text file (alert.txt).

![mta-005.png](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.005.png)

```
Count:6
Event#3.750 2021-02-08 15:59 UTC 
ET POLICY Lets Encrypt Free SSL Cert Observed
162\.241.149.195 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=1500 ID=0 flags=0 offset=0 ttl=0 chksum=27137 Protocol: 6 sport=443 -> dport=49736 
------------------------------------------------------------------------
Count:1 Event#3.767 2021-02-08 16:00 UTC
ET POLICY External IP Lookup api.ipify.org 10.2.8.101 -> 54.235.147.252 
IPVer=4 hlen=5 tos=0 dlen=204 ID=0 flags=0 offset=0 ttl=0 chksum=56542 Protocol: 6 sport=49754 -> dport=80 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=47744 chksum=0
------------------------------------------------------------------------
Count:10 Event#3.768 2021-02-08 16:00 UTC 
ETPRO MALWARE Tordal/Hancitor/Chanitor Checkin 10.2.8.101 -> 213.5.229.12 
IPVer=4 hlen=5 tos=0 dlen=443 ID=0 flags=0 offset=0 ttl=0 chksum=60612 Protocol: 6 sport=49755 -> dport=80 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=30910 chksum=0
------------------------------------------------------------------------
Count:1 Event#3.769 2021-02-08 16:00 UTC 
ET POLICY HTTP Request on Unusual Port Possibly Hostile 10.2.8.101 -> 198.211.10.238 
IPVer=4 hlen=5 tos=0 dlen=40 ID=8878 flags=2 offset=0 ttl=128 chksum=62457 Protocol: 6 sport=49758 -> dport=8080 
Seq=2871987428 Ack=1221200613 Off=5 Res=0 Flags=\*\*\*A\*\*\*\* Win=65535 urp=56826 chksum=0
------------------------------------------------------------------------
Count:3 Event#3.770 2021-02-08 16:00 UTC 
ET SHELLCODE Possible TCP x86 JMP to CALL Shellcode Detected
198\.211.10.238 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=159 ID=0 flags=0 offset=0 ttl=0 chksum=54833
Protocol: 6 sport=8080 -> dport=49758 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=8722 chksum=0
------------------------------------------------------------------------
Count:3 Event#3.774 2021-02-08 16:00 UTC 
ET POLICY exe download via HTTP - Informational 10.2.8.101 -> 8.208.10.147 
IPVer=4 hlen=5 tos=0 dlen=219 ID=0 flags=0 offset=0 ttl=0 chksum=37972 Protocol: 6 sport=49757 -> dport=80 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=51520 chksum=0
------------------------------------------------------------------------
Count:5 Event#3.777 2021-02-08 16:00 UTC 
ET POLICY Binary Download Smaller than 1 MB Likely Hostile 8.208.10.147 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=1162 ID=0 flags=0 offset=0 ttl=0 chksum=37029 Protocol: 6 sport=80 -> dport=49757 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=10912 chksum=0
------------------------------------------------------------------------
Count:5 Event#3.782 2021-02-08 16:00 UTC 
ET INFO Packed Executable Download 
8\.208.10.147 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=1162 ID=0 flags=0 offset=0 ttl=0 chksum=37029 Protocol: 6 sport=80 -> dport=49757 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=10912 chksum=0
------------------------------------------------------------------------
Count:1 Event#3.787 2021-02-08 16:00 UTC 
ETPRO MALWARE Meterpreter or Other Reverse Shell SSL Cert 198.211.10.238 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=1176 ID=0 flags=0 offset=0 ttl=0 chksum=53816 Protocol: 6 sport=443 -> dport=49759 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=21749 chksum=0
------------------------------------------------------------------------
Count:250 Event#3.788 2021-02-08 16:00 UTC 
ETPRO MALWARE Cobalt Strike Beacon Observed 10.2.8.101 -> 198.211.10.238 
IPVer=4 hlen=5 tos=0 dlen=430 ID=0 flags=0 offset=0 ttl=0 chksum=54562 Protocol: 6 sport=49760 -> dport=8080 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=9750 chksum=0
------------------------------------------------------------------------
Count:32 Event#3.789 2021-02-08 16:00 UTC 
ET POLICY PE EXE or DLL Windows file download HTTP 
8\.208.10.147 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=1162 ID=0 flags=0 offset=0 ttl=0 chksum=37029 Protocol: 6 sport=80 -> dport=49757 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=10912 chksum=0
------------------------------------------------------------------------
Count:3 Event#3.821 2021-02-08 16:00 UTC 
ET MALWARE VMProtect Packed Binary Inbound via HTTP - Likely Hostile 8.208.10.147 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=1500 ID=0 flags=0 offset=0 ttl=0 chksum=36691 Protocol: 6 sport=80 -> dport=49757 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=64861 chksum=0
------------------------------------------------------------------------
Count:1 Event#3.825 2021-02-08 16:00 UTC 
ET POLICY External IP Lookup (ipify .org) 10.2.8.101 -> 54.235.147.252 
IPVer=4 hlen=5 tos=0 dlen=264 ID=0 flags=0 offset=0 ttl=0 chksum=56482 Protocol: 6 sport=49761 -> dport=80 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=8884 chksum=0
------------------------------------------------------------------------
Count:2 Event#3.828 2021-02-08 16:00 UTC 
ET MALWARE Win32/Ficker Stealer Activity
185\.100.65.29 -> 10.2.8.101 
IPVer=4 hlen=5 tos=0 dlen=81 ID=15075 flags=0 offset=0 ttl=128 chksum=62171 Protocol: 6 sport=80 -> dport=49763 
Seq=405699802 Ack=3790664959 Off=5 Res=0 Flags=\*\*\*AP\*\*\* Win=64240 urp=46503 chksum=0
------------------------------------------------------------------------
Count:2 Event#3.829 2021-02-08 16:00 UTC 
ET MALWARE Win32/Ficker Stealer Activity M3 10.2.8.101 -> 185.100.65.29 
IPVer=4 hlen=5 tos=0 dlen=48 ID=11072 flags=2 offset=0 ttl=128 chksum=49823 Protocol: 6 sport=49763 -> dport=80 
Seq=3790664959 Ack=405699843 Off=5 Res=0 Flags=\*\*\*AP\*\*\* Win=64199 urp=18464 chksum=0
------------------------------------------------------------------------
Count:5 Event#3.883 2021-02-08 16:01 UTC 
ET POLICY HTTP POST on unusual Port Possibly Hostile 10.2.8.101 -> 198.211.10.238 
IPVer=4 hlen=5 tos=0 dlen=432 ID=0 flags=0 offset=0 ttl=0 chksum=54560
Protocol: 6 sport=49821 -> dport=8080 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=24014 chksum=0
------------------------------------------------------------------------
Count:5 Event#3.884 2021-02-08 16:01 UTC 
ET HUNTING GENERIC SUSPICIOUS POST to Dotted Quad with Fake Browser 1 10.2.8.101 -> 198.211.10.238 IPVer=4 hlen=5 tos=0 dlen=432 ID=0 flags=0 offset=0 ttl=0 chksum=54560 Protocol: 6 sport=49821 -> dport=8080 
Seq=0 Ack=0 Off=5 Res=0 Flags=\*\*\*\*\*\*\*\* Win=0 urp=24014 chksum=0
```
So, the information we have so far about the victim: 

IP Address: **10.2.8.101**. 

Related ports on the sessions: **80**, **443**, **8080**. 

The following are the suspected IP addresses that will be analyzed later in the report: 

**162.241.149.195** – look like it used Let’s Encrypt for create session-based SSL. 

**54.235.147.252** – sort of using API (ipify.org) for making external lookup. 

**213.5.229.12** – which is session that may contain type of malware.

**198.211.10.238** – used http on port 8080 which is unusual port, also look suspected, because it look like create with possible type of shellcode like reverse shell and/or Meterpreter as we can see on the screenshot. 

**8.208.10.147** – used for download EXE and DLL files, that session may related to the others.

**185.100.65.29** – also session that contain type of malware.

## Step 2: Identifying Source Host Information 

So now after we have that all information, we can use the source .pcap file to find more information about the victim. So far, we know the source IP address of that host, so we can use the following filter on the search box: 

**ip.addr == 10.2.8.101 && nbns**

![mta-009.png](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.009.png)

Also, for get the full hostname, we can use Wireshark setting that can display the full hostname in the packet, we just need to click and select the following **View**>**Name Resolution**>**Resolve Network Address**. 

![mta-010.png](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.010.png)

We can clearly see the hostname for that PC, also by opening the frame we can find the MAC address for that source, also Wireshark can give us the vendor’s name which is in that case HP. 

![mta-011.png](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.011.png)

` `And by lookup that source MAC address we can verify the vendor registration for that mac address and last update, which in our case is oct 2004, that may tell us that this is an old machine.

![mta-012.png](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.012.png)

For finding more details about the OS version of that host we can use HTTP filter from that source and search the user-agent filed which should tell us what the OS type and the browser is used.

![mta-013](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.013.png)

Using online parsing tool for that user-agent, tell us that in that case the OS is windows 10 the browser in used most likely Edge, we also have the version of that Edge.

![mta-014](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.014.png)

To find more information like the build number of the windows 10 we can use the following filer: 

**ip.src == 10.2.8.101 && ntlmssp** 

The NTLMSSP (NT LAN Manager Security Support Provider) protocol is used for authentication in Windows environments. 

![mta-015.png](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.015.png)

Also, the source user can be found by the same filter, since SMB2 Session Setup Request was made for establishing a session between a client and server, it also can reveal the source user's identity. This packet is sent by the client to initiate a session with the server, and it includes an important component called the "Session. Setup Request" structure. Within this structure, the client provides authentication information which may include Kerberos tokens or NTLMSSP (in our case). If NTLMSSP is used, the Type 3 Authentication packet, part of the NTLMSSP handshake, contains the username, domain, and other credentials. 

![mta-016.png](/assets/images/malware-analysis/Aspose.Words.68b47960-b03f-4f3f-ad39-2b858e879ce2.016.png)

So now we have the following information about the host which most likely the victim: Hostname: **DESKTOP-MGVG60Z.ascolimited.com** 

IP Address: **10.2.8.101** 

MAC Address: **00:12:79:41:c2:aa** 

Machine Vendor: **Hewlett Packard** 

OS Version: **Windows 10 build 19041** 

Source User: **bill.cook** 

Local Domain Name:  **ASCOLIMITED** 

By gathering this information, we can keep it in mind as we proceed, allowing us to analyze the PCAP file further and extract the relevant IOCs from it. 

